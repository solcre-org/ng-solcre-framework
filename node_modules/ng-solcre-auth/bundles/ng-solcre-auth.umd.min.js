!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("angular-2-local-storage"),require("@angular/common/http"),require("@angular/router"),require("@angular/core"),require("@angular/forms"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-solcre-auth",["exports","angular-2-local-storage","@angular/common/http","@angular/router","@angular/core","@angular/forms","@angular/common","rxjs","rxjs/operators"],t):t((e=e||self)["ng-solcre-auth"]={},e.angular2LocalStorage,e.ng.common.http,e.ng.router,e.ng.core,e.ng.forms,e.ng.common,e.rxjs,e.rxjs.operators)}(this,(function(e,t,o,r,n,i,a,s,c){"use strict";var u=function(e,t,o){this.token=e,this.refreshToken=t,this.expiration=o};var l="https://api.columnis.com/",d="001/columnis/clients",h="/oauth",p=function(){function e(e,t,o){this.router=e,this.httpClient=t,this.localStorageService=o,this.searchingCode=new n.EventEmitter,this.codeNotFound=new n.EventEmitter}return e.prototype.isAuthenticated=function(){return!!this.localStorageService.get("access_token")},e.prototype.login=function(e,t){var o=this,r=e.split("@");this.httpClient.post(l+this.codeDomain+h,{client_id:"columnis_manager",grant_type:"password",username:r[0],password:t}).subscribe((function(e){o.localStorageService.set("code",o.codeDomain),o.localStorageService.set("access_token",e.access_token),console.log("Logged in",e),o.router.navigate(["/"]),o.accessToken=o.parseAccessToken(e)}),(function(e){console.log(void 0),console.log(e.error.detail)}))},e.prototype.logout=function(){this.localStorageService.remove("access_token"),this.localStorageService.remove("code"),this.router.navigate(["/oauth"])},e.prototype.getAccessToken=function(){return this.localStorageService.get("access_token")},e.prototype.setCode=function(e){var t=this;if(this.searchingCode.emit(!0),this.localStorageService.get(e))console.log("desde ls"),this.codeNotFound.emit(!1),this.searchingCode.emit(!1),this.codeDomain=this.localStorageService.get(e);else{var r=(new o.HttpParams).set("domain",e);this.httpClient.get(l+d,{params:r}).subscribe((function(o){t.codeDomain=o.code,"000"!=t.codeDomain?(t.localStorageService.set(e,t.codeDomain),t.searchingCode.emit(!1)):(t.searchingCode.emit(!1),t.codeNotFound.emit(!0))}),(function(e){t.searchingCode.emit(!1),t.codeNotFound.emit(!0),console.log(e)}))}},e.prototype.getCode=function(){return this.localStorageService.get("code")},e.prototype.parseAccessToken=function(e){var t=null;if(e&&e.access_token){var o=new Date;o.setMinutes(o.getMinutes()+e.expires_in/60),t=new u(e.access_token,e.refresh_token,o)}return console.log(t),t},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:r.Router},{type:o.HttpClient},{type:t.LocalStorageService}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(r.Router),n.ɵɵinject(o.HttpClient),n.ɵɵinject(t.LocalStorageService))},token:e,providedIn:"root"}),e}();var g=function(){function e(e,t){this.formBuilder=e,this.authService=t}return e.prototype.ngOnInit=function(){var e=this;this.signinForm=this.formBuilder.group({email:this.formBuilder.control(null,[i.Validators.required,i.Validators.email]),password:this.formBuilder.control(null,i.Validators.required)}),this.authService.codeNotFound.subscribe((function(t){e.codeNotFound=t})),this.authService.searchingCode.subscribe((function(t){e.searchingCode=t}))},e.prototype.onSubmit=function(){this.authService.login(this.signinForm.value.email,this.signinForm.value.password)},e.prototype.onBlur=function(){if(this.codeNotFound=!1,this.searchingCode=!1,this.signinForm.invalid,this.signinForm.value.email&&this.signinForm.value.email.indexOf("@")>-1){var e=this.signinForm.value.email.split("@",2)[1];this.authService.setCode(e)}},e.decorators=[{type:n.Component,args:[{selector:"lib-auth-library",template:'<form \n    name="app-login-form"\n    id="app-login-form"\n    class="styled-form" \n    [formGroup]="signinForm" \n    (ngSubmit)="onSubmit()">\n    <h1>Auth library</h1>\n    <div>\n        <input class="input" type="text" (blur)="onBlur()" id="email" formControlName="email" name="email"><br>\n    </div>\n    <label *ngIf="searchingCode" for="email">Buscando dominio...</label>\n    <label *ngIf="codeNotFound" for="email">*Error al encontrar dominio</label>\n    <div>\n        <input class="input" type="password" id="password" formControlName="password" name="password"><br>\n    </div>\n    <button class="rounded-btn" type="submit">Entrar</button>\n</form>'}]}],e.ctorParameters=function(){return[{type:i.FormBuilder},{type:p}]},e}();var m=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{declarations:[g],imports:[t.LocalStorageModule,a.CommonModule,i.FormsModule,o.HttpClientModule,i.ReactiveFormsModule],exports:[g],providers:[p]}]}],e}(),f=function(){function e(e,t){this.authService=e,this.router=t}return e.prototype.canActivate=function(e,t){if(this.authService.isAuthenticated())return!0;this.router.navigate(["/oauth"])},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:p},{type:r.Router}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(p),n.ɵɵinject(r.Router))},token:e,providedIn:"root"}),e}();var v=function(){function e(e){this.authService=e,this.isRefreshingToken=!1,this.tokenSubject=new s.BehaviorSubject(null)}return e.prototype.intercept=function(e,t){var r=this;return(t.handle(e).pipe(c.catchError((function(n,i){if(n instanceof o.HttpErrorResponse)switch(console.log(n),n.status){case 400:return r.handle400Error(n);case 401:return r.handle401Error(n,e,t);case 403:return r.handle403Error(n)}return new s.Observable}))))},e.prototype.addToken=function(e,t){return e.clone({setHeaders:{Authorization:"Bearer "+t}})},e.prototype.logout=function(e){return this.authService.logout(),s.throwError(e)},e.prototype.handle403Error=function(e){return this.logout(e.message)},e.prototype.handle401Error=function(e,t,o){return t.url.indexOf("/oauth")>-1?s.throwError(e):this.logout(e.message)},e.prototype.handle400Error=function(e){return e&&400===e.status&&e.error&&"invalid_grant"===e.error.error?this.logout(e.message):s.throwError(e)},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:p}]},e}();e.AuthGuard=f,e.AuthInterceptor=v,e.AuthModule=m,e.AuthService=p,e.SolcreAuthLibraryComponent=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-solcre-auth.umd.min.js.map